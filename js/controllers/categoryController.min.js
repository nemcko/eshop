define(["controllers/controllers","services/apiService"],function(f){f.controller("CategoryCtrl",["$scope","ApiSvc","$modal","$stateParams","$sce",function(a,d,f,e,g){a.products=[];a.lastParamsCode="";a.showFilterTabs=[!0,!0,!0,!0,!0];a.$parent.GetPageSettings(a);a.ShowDetail=function(b){a.$parent.DlgDetail.Open(b)};a.SetFilters=function(b){a.filters=b};a.SwitchFilterTabs=function(b){var c=a.showFilterTabs[b];jQuery("#FilterTabs > li").removeClass("active");for(key in a.showFilterTabs)a.showFilterTabs[key]=
!0;a.showFilterTabs[b]=!c;a.showFilterTabs[b]||jQuery("#FilterTabs li:eq("+b+")").addClass("active")};a.SetColorFilter=function(){if(void 0!==a.filters){a.filters.colorFilter="";a.filters.colorFilterCount=0;for(var b in a.filters.colorFields)""!==a.filters.colorFields[b]&&(a.filters.colorFilter+=(a.filters.colorFilter?"+":"")+a.filters.colorFields[b],a.filters.colorFilterCount++)}};a.SetSizeFilter=function(){if(void 0!==a.filters){a.filters.sizeFilter="";a.filters.sizeFilterCount=0;for(var b in a.filters.sizeFields)""!==
a.filters.sizeFields[b]&&(a.filters.sizeFilter+=(a.filters.sizeFilter?"+":"")+a.filters.sizeFields[b],a.filters.sizeFilterCount++)}};a.SetBrandFilter=function(){if(void 0!==a.filters){a.filters.brandFilter="";a.filters.brandFilterCount=0;for(var b in a.filters.brandFields)""!==a.filters.brandFields[b]&&(a.filters.brandFilter+=(a.filters.brandFilter?"+":"")+a.filters.brandFields[b],a.filters.brandFilterCount++)}};a.ClearFilters=function(){if(void 0!==a.filters){for(var b in a.filters.colorFields)a.filters.colorFields[b]=
"";a.SetColorFilter();for(b in a.filters.sizeFields)a.filters.sizeFields[b]="";a.SetSizeFilter();for(b in a.filters.brandFields)a.filters.brandFields[b]="";a.SetBrandFilter();a.filters.priceFilter.priceFrom=a.filters.priceFilters.minPrice;a.filters.priceFilter.priceTo=a.filters.priceFilters.maxPrice;a.filters.textFilter=""}};a.ChangeFilterPrice=function(b){switch(b){case "+from":a.filters.priceFilter.priceFrom+=5;a.filters.priceFilter.priceFrom>a.filters.priceFilters.maxPrice&&(a.filters.priceFilter.priceFrom=
a.filters.priceFilters.maxPrice);break;case "-from":a.filters.priceFilter.priceFrom-=5;a.filters.priceFilter.priceFrom<a.filters.priceFilters.minPrice&&(a.filters.priceFilter.priceFrom=a.filters.priceFilters.minPrice);break;case "+to":a.filters.priceFilter.priceTo+=5;a.filters.priceFilter.priceTo>a.filters.priceFilters.maxPrice&&(a.filters.priceFilter.priceTo=a.filters.priceFilters.maxPrice);break;case "-to":a.filters.priceFilter.priceTo-=5,a.filters.priceFilter.priceTo<a.filters.priceFilters.minPrice&&
(a.filters.priceFilter.priceTo=a.filters.priceFilters.minPrice)}};a.updateFilterPrice=function(b){var c="";switch(b){case "from":c=a.filters.priceFilter.priceFrom;break;case "to":c=a.filters.priceFilter.priceTo}c=d.getNumber(c);switch(b){case "from":c>a.filters.priceFilters.maxPrice&&(c=a.filters.priceFilters.maxPrice);a.filters.priceFilter.priceFrom=parseFloat(c);break;case "to":c<a.filters.priceFilters.minPrice&&(c=a.filters.priceFilters.minPrice),a.filters.priceFilter.priceTo=parseFloat(c)}};a.SetProducts=
function(b){a.products=b.rows;a.pageData.totalItems=b.count;a.categoryname=b.categoryname};a.LoadPage=function(b){if(void 0===b||b&&void 0==a.lastFilters)a.lastFilters={},void 0!==a.filters&&(a.SetColorFilter(),a.SetSizeFilter(),a.SetBrandFilter(),a.filters.colorFilter&&(a.lastFilters.colorFilter=a.filters.colorFilter),a.filters.sizeFilter&&(a.lastFilters.sizeFilter=a.filters.sizeFilter),a.filters.brandFilter&&(a.lastFilters.brandFilter=a.filters.brandFilter),a.filters.priceFilter.priceFrom!=a.filters.priceFilters.minPrice&&
(a.lastFilters.priceFrom=a.filters.priceFilter.priceFrom),a.filters.priceFilter.priceTo!=a.filters.priceFilters.maxPrice&&(a.lastFilters.priceTo=a.filters.priceFilter.priceTo),a.filters.textFilter&&(a.lastFilters.textFilter=d.removeDiacritic(a.filters.textFilter,!0)));b=$.extend({},a.pageData,a.lastFilters);delete b.totalItems;var c=CryptoJS.MD5(e.id+$.param(b)).toString();a.lastParamsCode!=c&&(d.getData("data/acategory/"+e.id,b,a.SetProducts),a.alias=e.id,a.lastParamsCode=c)};a.SelectPagesize=function(b){a.pageData.pageSize=
b.value;a.pageData.currentPage=1;a.LoadPage()};a.SelectSortType=function(b){a.pageData.sortType=b.value;a.pageData.currentPage=1;a.LoadPage()};a.SelectPage=function(b){a.pageData.currentPage=b;a.LoadPage(!0)};d.getData("data/filters/"+e.id,a.pageData,a.SetFilters);a.LoadPage()}])});
