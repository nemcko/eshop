define(["controllers/controllers","services/apiService"],function(g){g.controller("RootCtrl",["$scope","ApiSvc","tools","$sce","$locale",function(a,d,e,g,l){a.showBasket="";a.clientData={sid:"sid",uid:0};a.defOptions=d.getData("data/defaultOptions");a.ClientData=function(b){if(b=d.decodeData(b,a.clientData.sid))a.clientData=b};a.SetMenus=function(b){a.menus=b};a.GetPageSettings=function(b){b.pageData=a.defOptions.pageSettings;b.pageData.totalItems=0;b.pageData.currentPage=1;b.pageSizes=a.defOptions.pageSizes;
b.sortTypes=a.defOptions.sortTypes};a.DetailDlgInit=function(a){a.product=void 0===a.data.sku?d.getData("data/product/"+a.data.idpro):d.getData("data/productvar/"+encodeURIComponent(a.data.idpro)+"/"+encodeURIComponent(a.data.sku));a.product.selSize=a.product.selColor.provars[a.product.selSizeIndex];a.descr=g.trustAsHtml(a.product.descr);return!0};a.DetailDlgVal=function(b){var c=b.product.selSize.id;b=b.product.quantity;if(void 0===b)return jQuery("#txtQuantity").focus(),e.MsgBox("Nespr\u00e1vne zadan\u00e9 mno\u017estvo",
"Nespr\u00e1vne zadan\u00e9 mno\u017estvo."),!1;a.AddBasketItem(c,b);a.ShowBasket(!0);return!0};a.AddBasketItem=function(b,c){d.setData("data/addbasketitem",a.clientData.sid,{idvar:b,quantity:c,lng:a.defOptions.pageSettings.lng},a.FillBasket)};a.UpdBasketItem=function(b,c){d.setData("data/updbasketitem",a.clientData.sid,{idvar:b,quantity:c,lng:a.defOptions.pageSettings.lng},a.FillBasket)};a.DelBasketItem=function(b){d.setData("data/delbasketitem",a.clientData.sid,{idvar:b,lng:a.defOptions.pageSettings.lng},
a.FillBasket)};a.ClearBasket=function(){d.setData("data/clearbasket",a.clientData.sid,{lng:a.defOptions.pageSettings.lng},a.FillBasket)};a.FillBasket=function(b){a.basket=b;a.$$phase||a.$apply()};a.ToggleBasket=function(){a.ShowBasket(!$("#BasketMenu").hasClass("ShowBasket"))};a.ShowBasket=function(b){a.showBasket=b?"ShowBasket":""};a.ShowDetail=function(b){a.DlgDetail.Open(b)};a.NewOrder=function(){a.ShowBasket(!1);d.goToState("neworder")};a.LogIn=function(){a.DlgLogin.Open({usr:"",pwd:""})};a.LoginDlgInit=
function(b){b.username=a.clientData.username;b.uid=a.clientData.uid};a.LoginDlgVal=function(b){if(a.clientData.uid)return d.getData("data/logout",null,a.ClientData),!0;if(b=d.setData("data/login",a.clientData.sid,b.data))return a.ClientData(b),!0;e.MsgBox("Prihl\u00e1senie","Zle zadan\u00e9 pou\u017e\u00edvate\u013esk\u00e9 meno alebo heslo.");return!1};a.NewReg=function(){a.DlgNewreg.Open(a)};a.NewPwd=function(){a.DlgNewpwd.Open(a)};a.FillDelivery=function(b,c){c.delivery=b;c.delivery.selDlv=c.delivery.items[0];
c.delivery.selDlvpay=c.delivery.items[0].dlvpay[0];if(b.userdata){c.userdata=b.userdata;for(var d in c.delivery.items)if(c.delivery.items[d].iddeliver===b.iddeliver){c.delivery.selDlv=c.delivery.items[d];for(var e in c.delivery.selDlv.dlvpay)if(c.delivery.selDlv.dlvpay[e].idmpay===b.idmpay){c.delivery.selDlvpay=c.delivery.selDlv.dlvpay[e];break}break}delete c.delivery.iddeliver;delete c.delivery.idmpay}c.$$phase||c.$apply();a.CalculateOrder(c)};a.CalculateOrder=function(b){b.delivery.price=0;b.delivery.szprice=
"";var c=0,e="",g="";void 0===a.basket&&(a.basket={});void 0!==a.basket.weight&&(c=a.basket.weight,price=a.basket.incVAT);void 0===b.userdata&&(b.userdata={});void 0===b.userdata.country&&(b.userdata.country="");for(var h in b.delivery.selDlv.dlvpri)b.delivery.selDlv.dlvpri[h].pfrom<price&&b.delivery.selDlv.dlvpri[h].pto>=price&&(g=b.delivery.selDlv.dlvpri[h].idpri);for(var k in b.delivery.selDlv.dlvwei)b.delivery.selDlv.dlvwei[k].wfrom<c&&b.delivery.selDlv.dlvwei[k].wto>=c&&(e=b.delivery.selDlv.dlvwei[k].idwei);
for(var f in b.delivery.selDlv.dlvtar)b.delivery.selDlv.dlvtar[f].country==b.userdata.country&&b.delivery.selDlv.dlvtar[f].idwei==e&&b.delivery.selDlv.dlvtar[f].idpri==g&&(b.delivery.price=b.delivery.selDlv.dlvtar[f].price);if(0===b.delivery.price)for(f in b.delivery.selDlv.dlvtar)b.delivery.selDlv.dlvtar[f].idwei==e&&b.delivery.selDlv.dlvtar[f].idpri==g&&(b.delivery.price=b.delivery.selDlv.dlvtar[f].price);0!==b.delivery.price&&(b.delivery.szprice=b.delivery.price.toString().replaceAll(".",l.NUMBER_FORMATS.DECIMAL_SEP));
a.basket.DlvPrice=d.getNumber(b.delivery.price,".")+d.getNumber(b.delivery.selDlvpay.payprice,".");a.basket.DlvPrice=a.basket.DlvPrice.toFixed(2);a.basket.TotalPrice=parseFloat(a.basket.incVAT)+parseFloat(a.basket.DlvPrice);a.basket.TotalPrice=a.basket.TotalPrice.toFixed(2);a.basket.szDlvPrice=a.basket.DlvPrice.toString().replaceAll(".",",");a.basket.szTotalPrice=a.basket.TotalPrice.toString().replaceAll(".",",")};d.getData("data/clientdata",{xdata:d.encodeData(a.clientData.sid,"sid")},a.ClientData);
d.getData("data/menus",null,a.SetMenus);d.getData("data/basket",null,a.FillBasket);e.AddDialog(a,"DlgDetail","views/prodetail.html",a.DetailDlgInit,a.DetailDlgVal);e.AddDialog(a,"DlgLogin","views/login.html",a.LoginDlgInit,a.LoginDlgVal);e.AddDialog(a,"DlgNewreg","views/newreg.html");e.AddDialog(a,"DlgNewpwd","views/newpwd.html")}])});
